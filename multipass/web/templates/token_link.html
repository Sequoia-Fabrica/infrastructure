{{ define "token_link.html" }}
{{ template "base.html" . }}
{{ end }}

{{ define "title" }}{{ .title }}{{ end }}

{{ define "content" }}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
        <div class="p-8">
            <div class="uppercase tracking-wide text-sm text-indigo-500 font-semibold">Share Your Digital ID</div>
            <h1 class="mt-2 text-xl font-bold text-gray-900">Your Shareable ID Card</h1>
            <p class="mt-2 text-gray-600">
                Scan this QR code or use the link below to share your digital ID card.
                This link will expire in 30 days.
            </p>

            <div class="mt-6 flex justify-center">
                <div class="qr-code-container">
                    {{ .qr_code_html }}
                </div>
            </div>

            <div class="mt-6">
                <label for="public-url" class="block text-sm font-medium text-gray-700">Shareable Link</label>
                <div class="mt-1 flex rounded-md shadow-sm">
                    <input type="text" name="public-url" id="public-url"
                           class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-md sm:text-sm border-gray-300 p-2 border"
                           value="{{ .public_url }}" readonly>
                    <button type="button" id="copy-button" onclick="copyShareableLink()"
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Copy
                    </button>
                </div>
                <div id="copy-status" class="text-xs text-green-500 mt-1" style="display: none;">Link copied to clipboard!</div>
            </div>

            <div class="mt-6">
                <p class="text-sm text-gray-500">
                    <strong>Security Note:</strong> This link contains a secure token that allows anyone with the link to view your digital ID card.
                    Do not share this link with people you don't trust.
                </p>
            </div>

            <div class="mt-6">
                <a href="/card" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Back to My Card
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function copyShareableLink() {
    // Get the input element with the URL
    var inputElement = document.getElementById('public-url');

    // Get the URL directly from the input value
    var url = inputElement.value;

    // Select the text in the input
    inputElement.select();
    inputElement.setSelectionRange(0, 99999); // For mobile devices

    // Try to copy using the most compatible method
    try {
        // Try the modern clipboard API first
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(url).then(function() {
                showCopySuccess();
            }).catch(function() {
                // If modern API fails, try the older method
                if (document.execCommand('copy')) {
                    showCopySuccess();
                }
            });
        } else {
            // Use the older method directly if modern API isn't available
            if (document.execCommand('copy')) {
                showCopySuccess();
            }
        }
    } catch (err) {
        console.error('Failed to copy: ', err);
    }
}

function showCopySuccess() {
    // Show success message
    var statusElement = document.getElementById('copy-status');
    statusElement.style.display = 'block';

    // Update button text
    var button = document.getElementById('copy-button');
    var originalText = button.textContent;
    button.textContent = 'Copied!';

    // Reset after 2 seconds
    setTimeout(function() {
        button.textContent = originalText;
        statusElement.style.display = 'none';
    }, 2000);
}
</script>
{{ end }}
